<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>회원가입 - SOA Backend</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin: 0;
        padding: 20px;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .register-container {
        background: white;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 600px;
      }

      .register-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .register-header h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 28px;
      }

      .register-header p {
        color: #666;
        margin: 0;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 500;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s;
        box-sizing: border-box;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .role-selection {
        display: flex;
        gap: 20px;
        margin-top: 10px;
      }

      .role-option {
        flex: 1;
        padding: 15px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
      }

      .role-option:hover {
        border-color: #667eea;
        background-color: #f8f9ff;
      }

      .role-option.selected {
        border-color: #667eea;
        background-color: #667eea;
        color: white;
      }

      .role-option input[type='radio'] {
        display: none;
      }

      .conditional-fields {
        display: none;
        margin-top: 20px;
        padding: 20px;
        background-color: #f8f9ff;
        border-radius: 8px;
        border: 1px solid #e1e5e9;
      }

      .conditional-fields.show {
        display: block;
      }

      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .checkbox-group input[type='checkbox'] {
        width: auto;
      }

      .register-button {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s;
      }

      .register-button:hover {
        transform: translateY(-2px);
      }

      .error-message {
        color: #e74c3c;
        background-color: #fdf2f2;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 20px;
        border: 1px solid #fecaca;
      }

      .field-error {
        color: #e74c3c;
        font-size: 14px;
        margin-top: 5px;
      }

      .login-link {
        text-align: center;
        margin-top: 20px;
      }

      .login-link a {
        color: #667eea;
        text-decoration: none;
      }

      .login-link a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="register-container">
      <div class="register-header">
        <h1>회원가입</h1>
        <p>SOA Backend 서비스에 가입하세요</p>
      </div>

      <!-- 에러 메시지 -->
      <div th:if="${error}" class="error-message" th:text="${error}"></div>

      <form
        th:action="@{/register}"
        th:object="${memberRegistration}"
        method="post"
      >
        <!-- 기본 정보 -->
        <div class="form-group">
          <label for="name">이름 *</label>
          <input type="text" id="name" th:field="*{name}" required />
          <div
            class="field-error"
            th:if="${#fields.hasErrors('name')}"
            th:errors="*{name}"
          ></div>
        </div>

        <div class="form-group">
          <label for="email">이메일 *</label>
          <input type="email" id="email" th:field="*{email}" required />
          <div
            class="field-error"
            th:if="${#fields.hasErrors('email')}"
            th:errors="*{email}"
          ></div>
        </div>

        <div class="form-group">
          <label for="phone">전화번호 *</label>
          <input type="tel" id="phone" th:field="*{phone}" required />
          <div
            class="field-error"
            th:if="${#fields.hasErrors('phone')}"
            th:errors="*{phone}"
          ></div>
        </div>

        <!-- 역할 선택 -->
        <div class="form-group">
          <label>역할 선택 *</label>
          <div class="role-selection">
            <div class="role-option" data-role="GUARDIAN">
              <input
                type="radio"
                id="guardian"
                th:field="*{role}"
                value="GUARDIAN"
              />
              <div>
                <strong>보호자</strong>
                <p>아이를 돌봐줄 튜터를 찾는 보호자</p>
              </div>
            </div>
            <div class="role-option" data-role="TUTOR">
              <input type="radio" id="tutor" th:field="*{role}" value="TUTOR" />
              <div>
                <strong>튜터</strong>
                <p>아이를 돌봐주는 튜터</p>
              </div>
            </div>
          </div>
          <div
            class="field-error"
            th:if="${#fields.hasErrors('role')}"
            th:errors="*{role}"
          ></div>
        </div>

        <!-- Guardian 전용 필드 -->
        <div id="guardian-fields" class="conditional-fields">
          <h3>보호자 추가 정보</h3>
          <div class="form-group">
            <div class="checkbox-group">
              <input
                type="checkbox"
                id="governmentSupport"
                th:field="*{governmentSupport}"
              />
              <label for="governmentSupport">정부 지원 대상자입니다</label>
            </div>
          </div>
        </div>

        <!-- Tutor 전용 필드 -->
        <div id="tutor-fields" class="conditional-fields">
          <h3>튜터 추가 정보</h3>
          <div class="form-group">
            <label for="birthDate">생년월일</label>
            <input type="date" id="birthDate" th:field="*{birthDate}" />
          </div>
          <div class="form-group">
            <label for="address">주소</label>
            <input type="text" id="address" th:field="*{address}" />
          </div>
          <div class="form-group">
            <label for="career">경력</label>
            <textarea
              id="career"
              th:field="*{career}"
              rows="3"
              placeholder="관련 경력을 입력해주세요"
            ></textarea>
          </div>
          <div class="form-group">
            <label for="certification">자격증</label>
            <input
              type="text"
              id="certification"
              th:field="*{certification}"
              placeholder="보유 자격증을 입력해주세요"
            />
          </div>
        </div>

        <button type="submit" class="register-button">
          다음 단계 (패스키 설정)
        </button>
      </form>

      <div class="login-link">
        <p>이미 계정이 있으신가요? <a th:href="@{/login}">로그인</a></p>
      </div>
    </div>

    <script>
      // 역할 선택에 따른 조건부 필드 표시
      document.addEventListener('DOMContentLoaded', function () {
        const roleOptions = document.querySelectorAll('.role-option');
        const guardianFields = document.getElementById('guardian-fields');
        const tutorFields = document.getElementById('tutor-fields');

        roleOptions.forEach((option) => {
          option.addEventListener('click', function () {
            const role = this.dataset.role;
            const radio = this.querySelector('input[type="radio"]');

            // 모든 옵션에서 selected 클래스 제거
            roleOptions.forEach((opt) => opt.classList.remove('selected'));

            // 클릭된 옵션에 selected 클래스 추가
            this.classList.add('selected');

            // 라디오 버튼 선택
            radio.checked = true;

            // 조건부 필드 표시/숨김
            guardianFields.classList.remove('show');
            tutorFields.classList.remove('show');

            if (role === 'GUARDIAN') {
              guardianFields.classList.add('show');
            } else if (role === 'TUTOR') {
              tutorFields.classList.add('show');
            }
          });
        });

        // 페이지 로드시 선택된 역할이 있으면 해당 필드 표시
        const selectedRole = document.querySelector(
          'input[name="role"]:checked'
        );
        if (selectedRole) {
          const roleOption = document.querySelector(
            `[data-role="${selectedRole.value}"]`
          );
          if (roleOption) {
            roleOption.classList.add('selected');
            if (selectedRole.value === 'GUARDIAN') {
              guardianFields.classList.add('show');
            } else if (selectedRole.value === 'TUTOR') {
              tutorFields.classList.add('show');
            }
          }
        }
      });
    </script>
  </body>
</html>
